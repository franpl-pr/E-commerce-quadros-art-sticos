{"ast":null,"code":"var Sequence = require('./Sequence');\nvar Util = require('util');\nvar Packets = require('../packets');\nvar Auth = require('../Auth');\nmodule.exports = ChangeUser;\nUtil.inherits(ChangeUser, Sequence);\nfunction ChangeUser(options, callback) {\n  Sequence.call(this, options, callback);\n  this._user = options.user;\n  this._password = options.password;\n  this._database = options.database;\n  this._charsetNumber = options.charsetNumber;\n  this._currentConfig = options.currentConfig;\n}\nChangeUser.prototype.determinePacket = function determinePacket(firstByte) {\n  switch (firstByte) {\n    case 0xfe:\n      return Packets.AuthSwitchRequestPacket;\n    case 0xff:\n      return Packets.ErrorPacket;\n    default:\n      return undefined;\n  }\n};\nChangeUser.prototype.start = function (handshakeInitializationPacket) {\n  var scrambleBuff = handshakeInitializationPacket.scrambleBuff();\n  scrambleBuff = Auth.token(this._password, scrambleBuff);\n  var packet = new Packets.ComChangeUserPacket({\n    user: this._user,\n    scrambleBuff: scrambleBuff,\n    database: this._database,\n    charsetNumber: this._charsetNumber\n  });\n  this._currentConfig.user = this._user;\n  this._currentConfig.password = this._password;\n  this._currentConfig.database = this._database;\n  this._currentConfig.charsetNumber = this._charsetNumber;\n  this.emit('packet', packet);\n};\nChangeUser.prototype['AuthSwitchRequestPacket'] = function (packet) {\n  var name = packet.authMethodName;\n  var data = Auth.auth(name, packet.authMethodData, {\n    password: this._password\n  });\n  if (data !== undefined) {\n    this.emit('packet', new Packets.AuthSwitchResponsePacket({\n      data: data\n    }));\n  } else {\n    var err = new Error('MySQL is requesting the ' + name + ' authentication method, which is not supported.');\n    err.code = 'UNSUPPORTED_AUTH_METHOD';\n    err.fatal = true;\n    this.end(err);\n  }\n};\nChangeUser.prototype['ErrorPacket'] = function (packet) {\n  var err = this._packetToError(packet);\n  err.fatal = true;\n  this.end(err);\n};","map":{"version":3,"names":["Sequence","require","Util","Packets","Auth","module","exports","ChangeUser","inherits","options","callback","call","_user","user","_password","password","_database","database","_charsetNumber","charsetNumber","_currentConfig","currentConfig","prototype","determinePacket","firstByte","AuthSwitchRequestPacket","ErrorPacket","undefined","start","handshakeInitializationPacket","scrambleBuff","token","packet","ComChangeUserPacket","emit","name","authMethodName","data","auth","authMethodData","AuthSwitchResponsePacket","err","Error","code","fatal","end","_packetToError"],"sources":["C:/Programas/quadrartes/node_modules/mysql/lib/protocol/sequences/ChangeUser.js"],"sourcesContent":["var Sequence = require('./Sequence');\nvar Util     = require('util');\nvar Packets  = require('../packets');\nvar Auth     = require('../Auth');\n\nmodule.exports = ChangeUser;\nUtil.inherits(ChangeUser, Sequence);\nfunction ChangeUser(options, callback) {\n  Sequence.call(this, options, callback);\n\n  this._user          = options.user;\n  this._password      = options.password;\n  this._database      = options.database;\n  this._charsetNumber = options.charsetNumber;\n  this._currentConfig = options.currentConfig;\n}\n\nChangeUser.prototype.determinePacket = function determinePacket(firstByte) {\n  switch (firstByte) {\n    case 0xfe: return Packets.AuthSwitchRequestPacket;\n    case 0xff: return Packets.ErrorPacket;\n    default: return undefined;\n  }\n};\n\nChangeUser.prototype.start = function(handshakeInitializationPacket) {\n  var scrambleBuff = handshakeInitializationPacket.scrambleBuff();\n  scrambleBuff     = Auth.token(this._password, scrambleBuff);\n\n  var packet = new Packets.ComChangeUserPacket({\n    user          : this._user,\n    scrambleBuff  : scrambleBuff,\n    database      : this._database,\n    charsetNumber : this._charsetNumber\n  });\n\n  this._currentConfig.user          = this._user;\n  this._currentConfig.password      = this._password;\n  this._currentConfig.database      = this._database;\n  this._currentConfig.charsetNumber = this._charsetNumber;\n\n  this.emit('packet', packet);\n};\n\nChangeUser.prototype['AuthSwitchRequestPacket'] = function (packet) {\n  var name = packet.authMethodName;\n  var data = Auth.auth(name, packet.authMethodData, {\n    password: this._password\n  });\n\n  if (data !== undefined) {\n    this.emit('packet', new Packets.AuthSwitchResponsePacket({\n      data: data\n    }));\n  } else {\n    var err   = new Error('MySQL is requesting the ' + name + ' authentication method, which is not supported.');\n    err.code  = 'UNSUPPORTED_AUTH_METHOD';\n    err.fatal = true;\n    this.end(err);\n  }\n};\n\nChangeUser.prototype['ErrorPacket'] = function(packet) {\n  var err = this._packetToError(packet);\n  err.fatal = true;\n  this.end(err);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}