{"ast":null,"code":"var Connection = require('./Connection');\nvar PoolSelector = require('./PoolSelector');\nmodule.exports = PoolNamespace;\n\n/**\n * PoolNamespace\n * @constructor\n * @param {PoolCluster} cluster The parent cluster for the namespace\n * @param {string} pattern The selection pattern to use\n * @param {string} selector The selector name to use\n * @public\n */\nfunction PoolNamespace(cluster, pattern, selector) {\n  this._cluster = cluster;\n  this._pattern = pattern;\n  this._selector = new PoolSelector[selector]();\n}\nPoolNamespace.prototype.getConnection = function (cb) {\n  var clusterNode = this._getClusterNode();\n  var cluster = this._cluster;\n  var namespace = this;\n  if (clusterNode === null) {\n    var err = null;\n    if (this._cluster._findNodeIds(this._pattern, true).length !== 0) {\n      err = new Error('Pool does not have online node.');\n      err.code = 'POOL_NONEONLINE';\n    } else {\n      err = new Error('Pool does not exist.');\n      err.code = 'POOL_NOEXIST';\n    }\n    cb(err);\n    return;\n  }\n  cluster._getConnection(clusterNode, function (err, connection) {\n    var retry = err && cluster._canRetry && cluster._findNodeIds(namespace._pattern).length !== 0;\n    if (retry) {\n      namespace.getConnection(cb);\n      return;\n    }\n    if (err) {\n      cb(err);\n      return;\n    }\n    cb(null, connection);\n  });\n};\nPoolNamespace.prototype.query = function (sql, values, cb) {\n  var cluster = this._cluster;\n  var clusterNode = this._getClusterNode();\n  var query = Connection.createQuery(sql, values, cb);\n  var namespace = this;\n  if (clusterNode === null) {\n    var err = null;\n    if (this._cluster._findNodeIds(this._pattern, true).length !== 0) {\n      err = new Error('Pool does not have online node.');\n      err.code = 'POOL_NONEONLINE';\n    } else {\n      err = new Error('Pool does not exist.');\n      err.code = 'POOL_NOEXIST';\n    }\n    process.nextTick(function () {\n      query.on('error', function () {});\n      query.end(err);\n    });\n    return query;\n  }\n  if (!(typeof sql === 'object' && 'typeCast' in sql)) {\n    query.typeCast = clusterNode.pool.config.connectionConfig.typeCast;\n  }\n  if (clusterNode.pool.config.connectionConfig.trace) {\n    // Long stack trace support\n    query._callSite = new Error();\n  }\n  cluster._getConnection(clusterNode, function (err, conn) {\n    var retry = err && cluster._canRetry && cluster._findNodeIds(namespace._pattern).length !== 0;\n    if (retry) {\n      namespace.query(query);\n      return;\n    }\n    if (err) {\n      query.on('error', function () {});\n      query.end(err);\n      return;\n    }\n\n    // Release connection based off event\n    query.once('end', function () {\n      conn.release();\n    });\n    conn.query(query);\n  });\n  return query;\n};\nPoolNamespace.prototype._getClusterNode = function _getClusterNode() {\n  var foundNodeIds = this._cluster._findNodeIds(this._pattern);\n  var nodeId;\n  switch (foundNodeIds.length) {\n    case 0:\n      nodeId = null;\n      break;\n    case 1:\n      nodeId = foundNodeIds[0];\n      break;\n    default:\n      nodeId = this._selector(foundNodeIds);\n      break;\n  }\n  return nodeId !== null ? this._cluster._getNode(nodeId) : null;\n};","map":{"version":3,"names":["Connection","require","PoolSelector","module","exports","PoolNamespace","cluster","pattern","selector","_cluster","_pattern","_selector","prototype","getConnection","cb","clusterNode","_getClusterNode","namespace","err","_findNodeIds","length","Error","code","_getConnection","connection","retry","_canRetry","query","sql","values","createQuery","process","nextTick","on","end","typeCast","pool","config","connectionConfig","trace","_callSite","conn","once","release","foundNodeIds","nodeId","_getNode"],"sources":["C:/Programas/quadrartes/node_modules/mysql/lib/PoolNamespace.js"],"sourcesContent":["var Connection   = require('./Connection');\nvar PoolSelector = require('./PoolSelector');\n\nmodule.exports = PoolNamespace;\n\n/**\n * PoolNamespace\n * @constructor\n * @param {PoolCluster} cluster The parent cluster for the namespace\n * @param {string} pattern The selection pattern to use\n * @param {string} selector The selector name to use\n * @public\n */\nfunction PoolNamespace(cluster, pattern, selector) {\n  this._cluster = cluster;\n  this._pattern = pattern;\n  this._selector = new PoolSelector[selector]();\n}\n\nPoolNamespace.prototype.getConnection = function(cb) {\n  var clusterNode = this._getClusterNode();\n  var cluster     = this._cluster;\n  var namespace   = this;\n\n  if (clusterNode === null) {\n    var err = null;\n\n    if (this._cluster._findNodeIds(this._pattern, true).length !== 0) {\n      err = new Error('Pool does not have online node.');\n      err.code = 'POOL_NONEONLINE';\n    } else {\n      err = new Error('Pool does not exist.');\n      err.code = 'POOL_NOEXIST';\n    }\n\n    cb(err);\n    return;\n  }\n\n  cluster._getConnection(clusterNode, function(err, connection) {\n    var retry = err && cluster._canRetry\n      && cluster._findNodeIds(namespace._pattern).length !== 0;\n\n    if (retry) {\n      namespace.getConnection(cb);\n      return;\n    }\n\n    if (err) {\n      cb(err);\n      return;\n    }\n\n    cb(null, connection);\n  });\n};\n\nPoolNamespace.prototype.query = function (sql, values, cb) {\n  var cluster     = this._cluster;\n  var clusterNode = this._getClusterNode();\n  var query       = Connection.createQuery(sql, values, cb);\n  var namespace   = this;\n\n  if (clusterNode === null) {\n    var err = null;\n\n    if (this._cluster._findNodeIds(this._pattern, true).length !== 0) {\n      err = new Error('Pool does not have online node.');\n      err.code = 'POOL_NONEONLINE';\n    } else {\n      err = new Error('Pool does not exist.');\n      err.code = 'POOL_NOEXIST';\n    }\n\n    process.nextTick(function () {\n      query.on('error', function () {});\n      query.end(err);\n    });\n    return query;\n  }\n\n  if (!(typeof sql === 'object' && 'typeCast' in sql)) {\n    query.typeCast = clusterNode.pool.config.connectionConfig.typeCast;\n  }\n\n  if (clusterNode.pool.config.connectionConfig.trace) {\n    // Long stack trace support\n    query._callSite = new Error();\n  }\n\n  cluster._getConnection(clusterNode, function (err, conn) {\n    var retry = err && cluster._canRetry\n      && cluster._findNodeIds(namespace._pattern).length !== 0;\n\n    if (retry) {\n      namespace.query(query);\n      return;\n    }\n\n    if (err) {\n      query.on('error', function () {});\n      query.end(err);\n      return;\n    }\n\n    // Release connection based off event\n    query.once('end', function() {\n      conn.release();\n    });\n\n    conn.query(query);\n  });\n\n  return query;\n};\n\nPoolNamespace.prototype._getClusterNode = function _getClusterNode() {\n  var foundNodeIds = this._cluster._findNodeIds(this._pattern);\n  var nodeId;\n\n  switch (foundNodeIds.length) {\n    case 0:\n      nodeId = null;\n      break;\n    case 1:\n      nodeId = foundNodeIds[0];\n      break;\n    default:\n      nodeId = this._selector(foundNodeIds);\n      break;\n  }\n\n  return nodeId !== null\n    ? this._cluster._getNode(nodeId)\n    : null;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}