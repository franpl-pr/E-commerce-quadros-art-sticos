{"ast":null,"code":"var Util = require('util');\nvar EventEmitter = require('events').EventEmitter;\nvar Packets = require('../packets');\nvar ErrorConstants = require('../constants/errors');\nvar Timer = require('../Timer');\n\n// istanbul ignore next: Node.js < 0.10 not covered\nvar listenerCount = EventEmitter.listenerCount || function (emitter, type) {\n  return emitter.listeners(type).length;\n};\nvar LONG_STACK_DELIMITER = '\\n    --------------------\\n';\nmodule.exports = Sequence;\nUtil.inherits(Sequence, EventEmitter);\nfunction Sequence(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  EventEmitter.call(this);\n  options = options || {};\n  this._callback = callback;\n  this._callSite = null;\n  this._ended = false;\n  this._timeout = options.timeout;\n  this._timer = new Timer(this);\n}\nSequence.determinePacket = function (byte) {\n  switch (byte) {\n    case 0x00:\n      return Packets.OkPacket;\n    case 0xfe:\n      return Packets.EofPacket;\n    case 0xff:\n      return Packets.ErrorPacket;\n    default:\n      return undefined;\n  }\n};\nSequence.prototype.hasErrorHandler = function () {\n  return Boolean(this._callback) || listenerCount(this, 'error') > 1;\n};\nSequence.prototype._packetToError = function (packet) {\n  var code = ErrorConstants[packet.errno] || 'UNKNOWN_CODE_PLEASE_REPORT';\n  var err = new Error(code + ': ' + packet.message);\n  err.code = code;\n  err.errno = packet.errno;\n  err.sqlMessage = packet.message;\n  err.sqlState = packet.sqlState;\n  return err;\n};\nSequence.prototype.end = function (err) {\n  if (this._ended) {\n    return;\n  }\n  this._ended = true;\n  if (err) {\n    this._addLongStackTrace(err);\n  }\n\n  // Without this we are leaking memory. This problem was introduced in\n  // 8189925374e7ce3819bbe88b64c7b15abac96b16. I suspect that the error object\n  // causes a cyclic reference that the GC does not detect properly, but I was\n  // unable to produce a standalone version of this leak. This would be a great\n  // challenge for somebody interested in difficult problems : )!\n  this._callSite = null;\n\n  // try...finally for exception safety\n  try {\n    if (err) {\n      this.emit('error', err);\n    }\n  } finally {\n    try {\n      if (this._callback) {\n        this._callback.apply(this, arguments);\n      }\n    } finally {\n      this.emit('end');\n    }\n  }\n};\nSequence.prototype['OkPacket'] = function (packet) {\n  this.end(null, packet);\n};\nSequence.prototype['ErrorPacket'] = function (packet) {\n  this.end(this._packetToError(packet));\n};\n\n// Implemented by child classes\nSequence.prototype.start = function () {};\nSequence.prototype._addLongStackTrace = function _addLongStackTrace(err) {\n  var callSiteStack = this._callSite && this._callSite.stack;\n  if (!callSiteStack || typeof callSiteStack !== 'string') {\n    // No recorded call site\n    return;\n  }\n  if (err.stack.indexOf(LONG_STACK_DELIMITER) !== -1) {\n    // Error stack already looks long\n    return;\n  }\n  var index = callSiteStack.indexOf('\\n');\n  if (index !== -1) {\n    // Append recorded call site\n    err.stack += LONG_STACK_DELIMITER + callSiteStack.substr(index + 1);\n  }\n};\nSequence.prototype._onTimeout = function _onTimeout() {\n  this.emit('timeout');\n};","map":{"version":3,"names":["Util","require","EventEmitter","Packets","ErrorConstants","Timer","listenerCount","emitter","type","listeners","length","LONG_STACK_DELIMITER","module","exports","Sequence","inherits","options","callback","call","_callback","_callSite","_ended","_timeout","timeout","_timer","determinePacket","byte","OkPacket","EofPacket","ErrorPacket","undefined","prototype","hasErrorHandler","Boolean","_packetToError","packet","code","errno","err","Error","message","sqlMessage","sqlState","end","_addLongStackTrace","emit","apply","arguments","start","callSiteStack","stack","indexOf","index","substr","_onTimeout"],"sources":["C:/Programas/quadrartes/node_modules/mysql/lib/protocol/sequences/Sequence.js"],"sourcesContent":["var Util           = require('util');\nvar EventEmitter   = require('events').EventEmitter;\nvar Packets        = require('../packets');\nvar ErrorConstants = require('../constants/errors');\nvar Timer          = require('../Timer');\n\n// istanbul ignore next: Node.js < 0.10 not covered\nvar listenerCount = EventEmitter.listenerCount\n  || function(emitter, type){ return emitter.listeners(type).length; };\n\nvar LONG_STACK_DELIMITER = '\\n    --------------------\\n';\n\nmodule.exports = Sequence;\nUtil.inherits(Sequence, EventEmitter);\nfunction Sequence(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  EventEmitter.call(this);\n\n  options = options || {};\n\n  this._callback = callback;\n  this._callSite = null;\n  this._ended    = false;\n  this._timeout  = options.timeout;\n  this._timer    = new Timer(this);\n}\n\nSequence.determinePacket = function(byte) {\n  switch (byte) {\n    case 0x00: return Packets.OkPacket;\n    case 0xfe: return Packets.EofPacket;\n    case 0xff: return Packets.ErrorPacket;\n    default:   return undefined;\n  }\n};\n\nSequence.prototype.hasErrorHandler = function() {\n  return Boolean(this._callback) || listenerCount(this, 'error') > 1;\n};\n\nSequence.prototype._packetToError = function(packet) {\n  var code = ErrorConstants[packet.errno] || 'UNKNOWN_CODE_PLEASE_REPORT';\n  var err  = new Error(code + ': ' + packet.message);\n  err.code = code;\n  err.errno = packet.errno;\n\n  err.sqlMessage = packet.message;\n  err.sqlState   = packet.sqlState;\n\n  return err;\n};\n\nSequence.prototype.end = function(err) {\n  if (this._ended) {\n    return;\n  }\n\n  this._ended = true;\n\n  if (err) {\n    this._addLongStackTrace(err);\n  }\n\n  // Without this we are leaking memory. This problem was introduced in\n  // 8189925374e7ce3819bbe88b64c7b15abac96b16. I suspect that the error object\n  // causes a cyclic reference that the GC does not detect properly, but I was\n  // unable to produce a standalone version of this leak. This would be a great\n  // challenge for somebody interested in difficult problems : )!\n  this._callSite = null;\n\n  // try...finally for exception safety\n  try {\n    if (err) {\n      this.emit('error', err);\n    }\n  } finally {\n    try {\n      if (this._callback) {\n        this._callback.apply(this, arguments);\n      }\n    } finally {\n      this.emit('end');\n    }\n  }\n};\n\nSequence.prototype['OkPacket'] = function(packet) {\n  this.end(null, packet);\n};\n\nSequence.prototype['ErrorPacket'] = function(packet) {\n  this.end(this._packetToError(packet));\n};\n\n// Implemented by child classes\nSequence.prototype.start = function() {};\n\nSequence.prototype._addLongStackTrace = function _addLongStackTrace(err) {\n  var callSiteStack = this._callSite && this._callSite.stack;\n\n  if (!callSiteStack || typeof callSiteStack !== 'string') {\n    // No recorded call site\n    return;\n  }\n\n  if (err.stack.indexOf(LONG_STACK_DELIMITER) !== -1) {\n    // Error stack already looks long\n    return;\n  }\n\n  var index = callSiteStack.indexOf('\\n');\n\n  if (index !== -1) {\n    // Append recorded call site\n    err.stack += LONG_STACK_DELIMITER + callSiteStack.substr(index + 1);\n  }\n};\n\nSequence.prototype._onTimeout = function _onTimeout() {\n  this.emit('timeout');\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}